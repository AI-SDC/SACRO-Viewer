{% extends "base.html" %}

{% load django_vite %}
{% load static %}

{% block extra_head %}
{% vite_asset "assets/src/scripts/researcher.js" %}
{% endblock %}

{% block content %}
<body class="grid h-screen overflow-hidden bg-zinc-100">

  {% #header %}
    <div class="flex items-center gap-x-12">
      <div></div>
      <div class="flex items-center gap-3 bg-zinc-200/50 px-4 py-2 rounded-lg border border-zinc-200">
        <div class="flex items-center gap-2 text-sm text-gray-700">
          <span class="h-2 w-2 rounded-full bg-green-500 animate-pulse"></span>
          <span>Viewing as Researcher</span>
        </div>
        <span class="text-gray-300"> â€¢ </span>
        <span class="font-semibold text-sm text-blue-600">@{{ username }}</span>
      </div>
    </div>
    <div class="flex gap-2">
      {% #button id="saveDraftBtn" type="button" variant="secondary-outline" %}
        Save Draft
      {% /button %}
      {% #button disabled=True id="finalizeBtn" type="submit" %}
        Finalize
      {% /button %}
    </div>
  {% /header %}


  <aside class="overflow-y-auto bg-white border-r border-zinc-200 py-2">
          <div class="px-2 pb-2">
            <div id="uploadZone" class="border-2 border-dashed border-zinc-300 rounded-lg p-6 text-center bg-zinc-50 hover:border-blue-500 hover:bg-blue-50 transition-colors cursor-pointer">
              <div class="text-4xl mb-2">ðŸ“¤</div>
              <div class="font-semibold text-sm text-zinc-800">Drop files here</div>
              <div class="text-xs text-zinc-500">or click to browse</div>
            </div>
          </div>
          <div class="px-2 pb-2 outputs-header flex items-center justify-between mt-4 mb-4">
              <div class="outputs-title text-sm font-semibold text-zinc-500 uppercase tracking-wide">Outputs</div>
              <div class="outputs-count bg-zinc-100 px-2.5 py-1 rounded-full text-xs font-semibold text-zinc-600" id="outputCount">0</div>
          </div>
          <h2 id="outputListHeader" class="sr-only">Output list</h2>
          <ul class="text-sm h-full flex flex-col gap-y-0.5" aria-label="List of outputs" id="outputList" data-sacro-el="outputList">
      {% for name, output in outputs.items %}
        {% include "_researcher_output_list_item.html" with name=name output=output %}
      {% endfor %}
    </ul>
  </aside>


  <main class="container overflow-y-scroll">
    {{ outputs|json_script:"outputData" }}
    {{ version|json_script:"outputVersion" }}
    {{ config|json_script:"outputConfig" }}
    {{ path|json_script:"currentPath" }}

    <div class="grid gap-y-4">

      <div class="overflow-hidden bg-white shadow">
        <div class="p-4">
          <h1 class="text-xl font-semibold leading-7 text-gray-900" data-sacro-el="outputTitle">
            Select an output
          </h1>
        </div>
        <div class="border-t border-gray-100">
          <dl class="divide-y divide-gray-100">
            <div class="px-4 py-2 grid grid-cols-4 gap-4 hidden" hidden>
              <dt class="text-sm font-medium text-gray-900">Created at</dt>
              <dd class="text-sm leading-6 text-gray-700 col-span-3" data-sacro-el="outputCreatedDate"></dd>
            </div>
            <div class="px-4 py-2 grid grid-cols-4 gap-4 hidden" hidden>
              <dt class="text-sm font-medium text-gray-900">Output type</dt>
              <dd class="text-sm leading-6 text-gray-700 col-span-3" data-sacro-el="outputType"></dd>
            </div>
            <div class="px-4 py-2 grid grid-cols-4 gap-4 hidden" hidden>
              <dt class="text-sm font-medium text-gray-900">ACRO status</dt>
              <dd class="text-sm leading-6 text-gray-700 col-span-3">
                <span data-sacro-el="outputDetailsStatus"></span>
                <span data-sacro-el="outputDetailsSummary"></span>
              </dd>
            </div>

            <div class="px-4 py-2 grid grid-cols-4 gap-4 hidden" hidden>
              <dt class="text-sm font-medium text-gray-900">Comments</dt>
              <dd class="text-sm leading-6 text-gray-700 col-span-3">
                <ul data-sacro-el="outputDetailsComments" class="list-disc ml-4"></ul>
                <button
                  type="button"
                  data-sacro-el="viewAllCommentsBtn"
                  class="text-blue-600 hover:text-blue-800 hover:underline text-sm mt-2 cursor-pointer"
                >
                  View All
                </button>
              </dd>
            </div>

            <div class="px-4 py-2 grid grid-cols-4 gap-4 hidden" hidden>
              <dt class="text-sm font-medium text-gray-900">Exception request</dt>
              <dd class="text-sm leading-6 text-gray-700 col-span-3">
                <span data-sacro-el="outputExceptionRequest"></span>
              </dd>
            </div>
          </dl>


          <div id="researcherForm">
            <form class="border-t border-gray-100 px-4 py-2 grid grid-cols-4 gap-4" style="display:none;">
              <h2 class="text-sm font-medium text-gray-900">Actions</h2>
              <div class="text-sm leading-6 text-gray-700 col-span-3">

                <label class="block font-semibold text-slate-900 mb-1" for="newComment">
                  Add Comment
                </label>
                <textarea
                  class="mt-1 mb-2 block w-full rounded-md border-slate-300 text-slate-900 shadow-sm resize-none sm:text-sm focus:border-oxford-500 focus:ring-oxford-500"
                  data-sacro-el="researcher-new-comment"
                  name="newComment"
                  id="newComment"
                  rows="3"
                ></textarea>
                <button
                  type="button"
                  data-sacro-el="researcher-add-comment-btn"
                  class="mb-6 inline-flex items-center justify-center border border-blue-600 bg-transparent text-blue-600 hover:bg-blue-50 transition-colors duration-200 px-4 py-2 text-sm font-medium rounded-md"
                >
                  Add Comment
                </button>

                <label class="block font-semibold text-slate-900 mb-1" for="exceptionRequest">
                  Exception Request
                </label>
                <textarea
                  class="mt-1 mb-2 block w-full rounded-md border-slate-300 text-slate-900 shadow-sm resize-none sm:text-sm focus:border-oxford-500 focus:ring-oxford-500"
                  data-sacro-el="researcher-exception-request"
                  name="exceptionRequest"
                  id="exceptionRequest"
                  rows="2"
                ></textarea>
                <button
                  type="button"
                  data-sacro-el="researcher-add-exception-btn"
                  class="inline-flex items-center justify-center border border-blue-600 bg-transparent text-blue-600 hover:bg-blue-50 transition-colors duration-200 px-4 py-2 text-sm font-medium rounded-md"
                >
                  Add Exception
                </button>
              </div>
            </form>
          </div>
          <template data-sacro-el="researcher-action-form" style="display:none;">
            <form class="border-t border-gray-100 px-4 py-2 grid grid-cols-4 gap-4">
              <h2 class="text-sm font-medium text-gray-900">Actions</h2>
              <div class="text-sm leading-6 text-gray-700 col-span-3">

                <label class="inline-block font-semibold text-slate-900 cursor-pointer" for="newComment">
                  Add Comment
                </label>
                <textarea
                  class="mt-1 mb-2 block w-full rounded-md border-slate-300 text-slate-900 shadow-sm resize-none sm:text-sm focus:border-oxford-500 focus:ring-oxford-500"
                  data-sacro-el="researcher-new-comment"
                  name="newComment"
                  id="newComment"
                  rows="3"
                ></textarea>
                <button
                  type="button"
                  data-sacro-el="researcher-add-comment-btn"
                  class="mb-4 inline-flex items-center justify-center shadow-sm transition-buttons duration-200 px-4 py-2 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700"
                >
                  Add Comment
                </button>


                <label class="inline-block font-semibold text-slate-900 cursor-pointer" for="exceptionRequest">
                  Exception Request
                </label>
                <textarea
                  class="mt-1 mb-2 block w-full rounded-md border-slate-300 text-slate-900 shadow-sm resize-none sm:text-sm focus:border-oxford-500 focus:ring-oxford-500"
                  data-sacro-el="researcher-exception-request"
                  name="exceptionRequest"
                  id="exceptionRequest"
                  rows="2"
                ></textarea>
                <button
                  type="button"
                  data-sacro-el="researcher-add-exception-btn"
                  class="inline-flex items-center justify-center shadow-sm transition-buttons duration-200 px-4 py-2 text-sm font-medium rounded-md bg-orange-600 text-white hover:bg-orange-700"
                >
                  Add Exception
                </button>
              </div>
            </form>
          </template>
        </div>
      </div>


      <div class="grid grid-col gap-y-4" id="filePreviewContainer"></div>

      <template data-sacro-el="file-preview-template">
        <section class="bg-white shadow">
          <div class="flex flex-row items-center gap-4 justify-between flex-wrap px-4 py-2">
            <h2 data-sacro-el="file-preview-template-title" class="text-lg font-semibold tracking-tight text-slate-900"></h2>
            {% #button data_sacro_el="file-preview-template-link" href="#" small type="link" variant="secondary-outline" %}
              Open file
            {% /button %}
          </div>
          <p data-sacro-el="file-preview-template-checksum" class="relative z-10 -mb-[1px] px-4 py-2 text-sm font-semibold text-red-700 text-center bg-red-50 border-x-4 border-red-700"></p>
          <div data-sacro-el="file-preview-template-content" class="px-4 py-3 md:px-6 border-t border-slate-200 md:py-5"></div>
        </section>
      </template>
    </div>
  </main>


  {% #modal id="commentsModal" title="All Comments" %}
    <div id="allCommentsList" class="space-y-4"></div>
  {% /modal %}

  {% #modal id="addOutputModal" title="Add New Output" %}
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Output Name</label>
        <input type="text" id="addOutputName" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="Enter output name">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Attachment</label>
        <input type="file" id="addOutputFile" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" accept=".csv,.xlsx,.txt,.pdf,.png,.jpg,.docx,.py,.do,.rmd,.r">
        <small class="text-gray-500 text-xs mt-1 block">Supported formats: CSV, XLSX, TXT, PDF, PNG, JPG, DOCX,PY,DO,Rmd,R</small>
      </div>
      <div class="flex gap-3 justify-end pt-4">
        <button id="cancelAddOutput" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
        <button id="confirmAddOutput" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">Add Output</button>
      </div>
    </div>
  {% /modal %}

  {% #modal id="editOutputModal" title="Edit Output" %}
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Output Name</label>
        <input type="text" id="editOutputName" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="Enter output name">
      </div>
      <div class="flex gap-3 justify-end pt-4">
        <button id="cancelEditOutput" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
        <button id="confirmEditOutput" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">Save Changes</button>
      </div>
    </div>
  {% /modal %}

  {% #modal id="deleteOutputModal" title="Delete Output" %}
    <div class="space-y-4">
      <p class="text-gray-600">Are you sure you want to delete "<span id="deleteOutputName"></span>"? This action cannot be undone.</p>
      <div class="flex gap-3 justify-end pt-4">
        <button id="cancelDeleteOutput" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
        <button id="confirmDeleteOutput" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700">Delete</button>
      </div>
    </div>
  {% /modal %}

  <template id="tooltip">
    {% tooltip %}
  </template>
</body>
{% endblock content %}
