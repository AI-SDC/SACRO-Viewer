{% load django_vite %}
{% load static %}

<!DOCTYPE html>
<html lang="en" class="min-h-screen">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>SACRO Outputs Viewer</title>

    {% vite_hmr_client %}
    {% vite_asset "assets/src/scripts/main.js" %}
  </head>

  <body class="grid h-screen overflow-hidden bg-zinc-100">
    <header class="header">
      <div class="flex gap-x-4 items-center">
        <img
          alt="SACRO logo"
          class="block h-8 w-auto"
          src="{% static "sacro.svg" %}"
        >
        <span class="text-xl font-extrabold text-zinc-800 tracking-tight leading-none">
          SACRO outputs viewer
        </span>
      </div>
      <form action="/" method="post" id="approveForm">
        {% csrf_token %}
        {% #button disabled=True id="openModalBtn" type="submit" %}
          Release and download
        {% /button %}
      </form>
    </header>

    <aside class="overflow-y-scroll bg-white border-r border-zinc-200 py-2">
      <h2 id="fileListHeader" class="sr-only">File list</h2>
      <ul class="text-sm h-full flex flex-col gap-y-0.5" aria-label="List of files" id="filesList" data-cy="filesList">
        {% for file in files %}
        <li
          aria-label="File: {{ file.name }}"
          class="
            relative group py-0.5 px-1 hover:bg-slate-50
            {% if file.status == "fail" %}
            text-red-800
            {% elif file.status == "pass" %}
            text-blue-800
            {% elif file.status == "review" %}
            text-fuchsia-900
            {% endif %}

            data-[review-status=true]:bg-green-100/50
            data-[review-status=false]:bg-red-100/50
          "

          data-file-name="{{ file.name }}"
          data-review-status="none"
        >
          <dl class="flex flex-row gap-x-2 items-center" aria-label="File information">
            <div class="order-2">
              <dt class="sr-only">File name:</dt>
              <dd>
                <a
                  href="#{{ file.url }}"
                  class="
                    before:absolute before:inset-0 before:w-full before:h-full before:z-0
                  "
                >
                  <span class="z-10 relative">
                    {{ file.name }}
                  </span>
                </a>
              </dd>
            </div>
            <div class="order-1">
              <dt class="sr-only">ACRO status:</dt>
              <dd>
                <span class="sr-only">{{ file.status }}</span>
                {% if file.status == "fail" %}
                {% icon_file_x class="h-5 w-5 stroke-red-700" %}
                {% elif file.status == "pass" %}
                {% icon_file class="h-5 w-5 stroke-blue-700" %}
                {% elif file.status == "review" %}
                {% icon_file_unknown class="h-5 w-5 stroke-fuchsia-700" %}
                {% endif %}
              </dd>
            </div>
            <div class="order-3 ml-auto">
              <dt class="sr-only">File type:</dt>
              <dd>{{ file.type }}</dd>
            </div>
            <div class="order-4">
              <dt class="sr-only">Review status:</dt>
              <dd>
                <span class="hidden group-data-[review-status=none]:block">
                  <span class="sr-only">Not yet reviewed</span>
                  <svg class="h-5 w-5"></svg>
                </span>
                <span class="hidden group-data-[review-status=true]:block">
                  <span class="sr-only">Approved</span>
                  {% icon_check class="h-5 w-5 text-green-600" %}
                </span>
                <span class="hidden group-data-[review-status=false]:block">
                  <span class="sr-only">Rejected</span>
                  {% icon_x_mark class="h-5 w-5 text-red-600" %}
                </span>
              </dd>
            </div>
          </dl>
        </li>
        {% endfor %}
      </ul>
    </aside>

    <main class="container overflow-y-scroll">
      {{ outputs|json_script:"filesData" }}

      <div class="flex flex-col gap-y-2 mt-1">
        <h1
          class="text-2xl font-semibold tracking-tight text-slate-900"
          data-sacro-el="fileTitle"
        >
          Select a file
        </h1>

        <details open class="bg-white border p-2" hidden>
          <summary class="text-lg font-semibold">Output</summary>
          <ul class="flex flex-col gap-y-2">
            <li>
              <strong>File names:</strong>
              <span data-sacro-el="fileDetailsFileNames"></span>
            </li>
            <li>
              <strong>Created at:</strong>
              <span data-sacro-el="fileCreatedDate"></span>
            </li>
          </ul>
        </details>

        <details open class="bg-white border p-2" hidden>
          <summary class="text-lg font-semibold">ACRO status</summary>
          <ul>
            <li>
              <strong>Status:</strong>
              <span data-sacro-el="fileDetailsStatus"></span>
            </li>
            <li>
              <strong>Summary:</strong>
              <ul class="list-disc ml-5" data-sacro-el="fileDetailsSummary"></ul>
            </li>
          </ul>
        </details>

        <details open class="bg-white border p-2" hidden>
          <summary class="text-lg font-semibold">Comments</summary>
          <ul data-sacro-el="fileDetailsComments" class="list-disc ml-4">
          </ul>
        </details>

        <details open class="bg-white border p-2" hidden>
          <summary class="text-lg font-semibold">Review</summary>
          <form data-sacro-el="fileDetailsReviewForm" action="GET">
            <fieldset class="flex flex-col">
              <legend class="font-semibold text-sm">Select a review status</legend>

              <div class="flex flex-row">
                <label class="min-w-[8ch] flex w-fit-content" for="approved">
                  <input class="sr-only" type="radio" name="fileReviewStatus" id="approved">
                  <span class="mx-auto">Approve</span>
                </label>
                <label class="min-w-[8ch] flex w-fit-content" for="rejected">
                  <input class="sr-only" type="radio" name="fileReviewStatus" id="rejected">
                  <span class="mx-auto">Reject</span>
                </label>
                <button class="ml-4" type="button">Reset review status</button>
              </div>
            </fieldset>

            <div class="flex flex-col mt-4">
              <label for="fileReviewComments">Add reasons for selected review status</label>
              <textarea name="fileReviewComments" id="fileReviewComments" rows="4"></textarea>
            </div>
          </form>
        </details>

        {% #card container=True container_id="fileContent" %}
        {% /card %}
      </div>
    </main>
  </body>
</html>
